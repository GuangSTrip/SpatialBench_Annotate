<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘æ’­æ”¾æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .video-player {
            width: 100%;
            max-width: 600px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>ğŸ¬ è§†é¢‘æ’­æ”¾åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. ç›´æ¥è§†é¢‘æ’­æ”¾æµ‹è¯•</h2>
        <p>æµ‹è¯•æµè§ˆå™¨æ˜¯å¦èƒ½ç›´æ¥æ’­æ”¾è§†é¢‘æ–‡ä»¶ï¼š</p>
        <video class="video-player" controls>
            <source src="/static/videos/sample1.mp4" type="video/mp4">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
        </video>
        <div id="directVideoStatus" class="status info">
            çŠ¶æ€ï¼šæ­£åœ¨æ£€æŸ¥è§†é¢‘æ’­æ”¾...
        </div>
    </div>

    <div class="test-section">
        <h2>2. JavaScriptåŠ¨æ€åˆ›å»ºè§†é¢‘æ’­æ”¾å™¨</h2>
        <p>æµ‹è¯•JavaScriptåŠ¨æ€åˆ›å»ºè§†é¢‘æ’­æ”¾å™¨ï¼š</p>
        <div id="dynamicVideoContainer"></div>
        <button onclick="createDynamicVideo()">åˆ›å»ºåŠ¨æ€è§†é¢‘æ’­æ”¾å™¨</button>
        <div id="dynamicVideoStatus" class="status info">
            çŠ¶æ€ï¼šç­‰å¾…åˆ›å»º...
        </div>
    </div>

    <div class="test-section">
        <h2>3. APIæ•°æ®æµ‹è¯•</h2>
        <p>æµ‹è¯•APIè¿”å›çš„æ•°æ®ï¼š</p>
        <button onclick="testAPI()">æµ‹è¯•API</button>
        <div id="apiStatus" class="status info">
            çŠ¶æ€ï¼šç­‰å¾…æµ‹è¯•...
        </div>
        <pre id="apiResult" style="background: #f8f9fa; padding: 10px; border-radius: 4px; display: none;"></pre>
    </div>

    <div class="test-section">
        <h2>4. è§†é¢‘æ–‡ä»¶è®¿é—®æµ‹è¯•</h2>
        <p>æµ‹è¯•è§†é¢‘æ–‡ä»¶æ˜¯å¦èƒ½æ­£å¸¸è®¿é—®ï¼š</p>
        <button onclick="testVideoAccess()">æµ‹è¯•è§†é¢‘è®¿é—®</button>
        <div id="videoAccessStatus" class="status info">
            çŠ¶æ€ï¼šç­‰å¾…æµ‹è¯•...
        </div>
    </div>

    <div class="test-section">
        <h2>5. æµè§ˆå™¨ä¿¡æ¯</h2>
        <div id="browserInfo" class="status info">
            æ­£åœ¨è·å–æµè§ˆå™¨ä¿¡æ¯...
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            // æµ‹è¯•1ï¼šç›´æ¥è§†é¢‘æ’­æ”¾
            testDirectVideo();
            
            // æµ‹è¯•5ï¼šæµè§ˆå™¨ä¿¡æ¯
            showBrowserInfo();
        });

        function testDirectVideo() {
            const video = document.querySelector('.video-player');
            const status = document.getElementById('directVideoStatus');
            
            video.addEventListener('loadstart', () => {
                status.textContent = 'çŠ¶æ€ï¼šå¼€å§‹åŠ è½½è§†é¢‘...';
                status.className = 'status info';
            });
            
            video.addEventListener('canplay', () => {
                status.textContent = 'çŠ¶æ€ï¼šè§†é¢‘å¯ä»¥æ’­æ”¾ âœ“';
                status.className = 'status success';
            });
            
            video.addEventListener('error', (e) => {
                status.textContent = 'çŠ¶æ€ï¼šè§†é¢‘åŠ è½½å¤±è´¥ âœ—';
                status.className = 'status error';
                console.error('Video error:', e);
            });
            
            // 5ç§’åæ£€æŸ¥è§†é¢‘çŠ¶æ€
            setTimeout(() => {
                if (video.readyState === 0) {
                    status.textContent = 'çŠ¶æ€ï¼šè§†é¢‘æœªåŠ è½½ âœ—';
                    status.className = 'status error';
                }
            }, 5000);
        }

        function createDynamicVideo() {
            const container = document.getElementById('dynamicVideoContainer');
            const status = document.getElementById('dynamicVideoStatus');
            
            status.textContent = 'çŠ¶æ€ï¼šæ­£åœ¨åˆ›å»ºåŠ¨æ€è§†é¢‘æ’­æ”¾å™¨...';
            status.className = 'status info';
            
            // æ¸…ç©ºå®¹å™¨
            container.innerHTML = '';
            
            // åˆ›å»ºæ–°çš„è§†é¢‘å…ƒç´ 
            const video = document.createElement('video');
            video.controls = true;
            video.style.width = '100%';
            video.style.maxWidth = '600px';
            
            const source = document.createElement('source');
            source.src = '/static/videos/sample1.mp4';
            source.type = 'video/mp4';
            
            video.appendChild(source);
            video.appendChild(document.createTextNode('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚'));
            
            container.appendChild(video);
            
            // ç»‘å®šäº‹ä»¶
            video.addEventListener('canplay', () => {
                status.textContent = 'çŠ¶æ€ï¼šåŠ¨æ€è§†é¢‘æ’­æ”¾å™¨åˆ›å»ºæˆåŠŸ âœ“';
                status.className = 'status success';
            });
            
            video.addEventListener('error', (e) => {
                status.textContent = 'çŠ¶æ€ï¼šåŠ¨æ€è§†é¢‘æ’­æ”¾å™¨åˆ›å»ºå¤±è´¥ âœ—';
                status.className = 'status error';
                console.error('Dynamic video error:', e);
            });
        }

        async function testAPI() {
            const status = document.getElementById('apiStatus');
            const result = document.getElementById('apiResult');
            
            status.textContent = 'çŠ¶æ€ï¼šæ­£åœ¨æµ‹è¯•API...';
            status.className = 'status info';
            
            try {
                const response = await fetch('/api/sample/sample_1/segments');
                if (response.ok) {
                    const data = await response.json();
                    status.textContent = 'çŠ¶æ€ï¼šAPIæµ‹è¯•æˆåŠŸ âœ“';
                    status.className = 'status success';
                    result.textContent = JSON.stringify(data, null, 2);
                    result.style.display = 'block';
                } else {
                    status.textContent = `çŠ¶æ€ï¼šAPIæµ‹è¯•å¤±è´¥ âœ— (HTTP ${response.status})`;
                    status.className = 'status error';
                }
            } catch (error) {
                status.textContent = `çŠ¶æ€ï¼šAPIæµ‹è¯•å¼‚å¸¸ âœ— (${error.message})`;
                status.className = 'status error';
                console.error('API test error:', error);
            }
        }

        async function testVideoAccess() {
            const status = document.getElementById('videoAccessStatus');
            
            status.textContent = 'çŠ¶æ€ï¼šæ­£åœ¨æµ‹è¯•è§†é¢‘æ–‡ä»¶è®¿é—®...';
            status.className = 'status info';
            
            try {
                const response = await fetch('/static/videos/sample1.mp4', { method: 'HEAD' });
                if (response.ok) {
                    const size = response.headers.get('Content-Length');
                    const type = response.headers.get('Content-Type');
                    status.textContent = `çŠ¶æ€ï¼šè§†é¢‘æ–‡ä»¶è®¿é—®æˆåŠŸ âœ“ (å¤§å°: ${size} bytes, ç±»å‹: ${type})`;
                    status.className = 'status success';
                } else {
                    status.textContent = `çŠ¶æ€ï¼šè§†é¢‘æ–‡ä»¶è®¿é—®å¤±è´¥ âœ— (HTTP ${response.status})`;
                    status.className = 'status error';
                }
            } catch (error) {
                status.textContent = `çŠ¶æ€ï¼šè§†é¢‘æ–‡ä»¶è®¿é—®å¼‚å¸¸ âœ— (${error.message})`;
                status.className = 'status error';
                console.error('Video access test error:', error);
            }
        }

        function showBrowserInfo() {
            const info = document.getElementById('browserInfo');
            const userAgent = navigator.userAgent;
            const videoSupport = document.createElement('video').canPlayType ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ';
            
            info.innerHTML = `
                <strong>æµè§ˆå™¨ä¿¡æ¯ï¼š</strong><br>
                User Agent: ${userAgent}<br>
                HTML5è§†é¢‘æ”¯æŒ: ${videoSupport}<br>
                Cookieå¯ç”¨: ${navigator.cookieEnabled ? 'æ˜¯' : 'å¦'}<br>
                åœ¨çº¿çŠ¶æ€: ${navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}
            `;
        }
    </script>
</body>
</html>
